workflows:
  expo-android-build:
    name: Expo Android Build with Upload
    max_build_duration: 120
    environment:
      node: 18.17.1
      java: 11
    scripts:
      - name: Install dependencies
        script: |
          pip3 install setuptools
          npm cache clean --force
          npm install
          npm install -g @expo/cli
          
      - name: Build APK
        script: |
          npx expo login --token $EXPO_TOKEN
          npx expo prebuild --platform android --clear
          
          cd android
          chmod +x gradlew
          ./gradlew assembleRelease
          
          # Copy APK to easy location
          cp app/build/outputs/apk/release/*.apk ../my-app.apk
          
      - name: Upload APK to file sharing
        script: |
          # Upload to transfer.sh (free file sharing)
          echo "Uploading APK to transfer.sh..."
          curl --upload-file my-app.apk https://transfer.sh/my-app.apk
          echo ""
          
          # Also try uploading to 0x0.st
          echo "Uploading to 0x0.st..."
          curl -F'file=@my-app.apk' https://0x0.st
          echo ""
          
          # Show file info
          ls -la my-app.apk
          
    artifacts:
      - my-app.apk
      - android/app/build/outputs/apk/release/*.apk
    
    publishing:
      email:
        recipients:
          - deamirclothingstores@gmail.com
        notify:
          success: true
          failure: true